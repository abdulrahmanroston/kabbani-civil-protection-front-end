<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>

       <!-- โ PWA Meta Tags -->
    <meta name="description" content="ูุธุงู ูุชุงุจุนุฉ ูุฅุฏุงุฑุฉ ุงูุญูุงูุฉ ุงููุฏููุฉ">
    <meta name="theme-color" content="#21808d">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ุงูุญูุงูุฉ ุงููุฏููุฉ">
    
    <!-- โ Manifest Link -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- โ Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png">
    <link rel="apple-touch-icon" href="/icon-192.png">
    

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุธุงู ุฅุฏุงุฑุฉ ุงูุญูุงูุฉ ุงููุฏููุฉ</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="spinner"></div>
        <p>ุฌุงุฑู ุงูุชุญููู...</p>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast hidden"></div>

    <!-- Login Page -->
    <div id="loginPage" class="login-page">
        <div class="login-container">
            <div class="login-header">
                <h1>๐ก๏ธ ูุธุงู ุฅุฏุงุฑุฉ ุงูุญูุงูุฉ ุงููุฏููุฉ</h1>
                <p>ุชุณุฌูู ุงูุฏุฎูู ูููุธุงู</p>
            </div>
            <form id="loginForm" class="login-form">
                <div class="form-group">
                    <label for="identifier">ุงุณู ุงููุณุชุฎุฏู ุฃู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label>
                    <input type="text" id="identifier" name="identifier" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label for="password">ูููุฉ ุงููุฑูุฑ</label>
                    <input type="password" id="password" name="password" required autocomplete="current-password">
                </div>
                <button type="submit" class="btn btn-primary btn-block">ุชุณุฌูู ุงูุฏุฎูู</button>
            </form>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="main-app hidden">
        <!-- Top Navigation -->
        <nav class="top-nav">
            <div class="nav-container">
                <button id="menuToggle" class="menu-toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <div class="nav-brand">๐ก๏ธ ูุธุงู ุฅุฏุงุฑุฉ ุงูุญูุงูุฉ ุงููุฏููุฉ</div>
                <div class="nav-user">
                    <span id="userName" class="user-name"></span>
                    <button id="logoutBtn" class="btn btn-small btn-outline">ุชุณุฌูู ุงูุฎุฑูุฌ</button>
                </div>
            </div>
        </nav>

        <div class="app-layout">
            <!-- Sidebar Navigation -->
            <aside id="sidebar" class="sidebar">
                <ul class="sidebar-menu">
                    <li><a href="#dashboard" class="menu-item active" data-view="dashboard">
                        <span class="menu-icon">๐</span>
                        <span class="menu-text">ููุญุฉ ุงูุชุญูู</span>
                    </a></li>
                    <li><a href="#branches" class="menu-item" data-view="branches">
                        <span class="menu-icon">๐ข</span>
                        <span class="menu-text">ุงููุฑูุน</span>
                    </a></li>
                    <li><a href="#followups" class="menu-item" data-view="followups">
                        <span class="menu-icon">๐</span>
                        <span class="menu-text">ุชูุงุฑูุฑ ุงููุชุงุจุนุฉ</span>
                    </a></li>
                    <li><a href="#tasks" class="menu-item" data-view="tasks">
                        <span class="menu-icon">โ</span>
                        <span class="menu-text">ุงูููุงู ูุงููุทููุจุงุช</span>
                    </a></li>
                </ul>
            </aside>

            <!-- Main Content Area -->
            <main class="content">
                <div id="viewContainer"></div>
            </main>
        </div>
    </div>

    <!-- Modal Container -->
    <div id="modalContainer" class="modal-overlay hidden"></div>

    <!-- Scripts -->
    <script src="config.js"></script>
    <script src="utils.js"></script>
    <script src="api.js"></script>
    <script src="auth.js"></script>
    <script src="components.js"></script>
    <script src="app.js"></script>
    <!-- โ Service Worker Registration -->
    <script>
        // ุชุณุฌูู Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('โ [PWA] Service Worker registered:', registration.scope);
                        
                        // ุงูุชุญูู ูู ุงูุชุญุฏูุซุงุช ูู 5 ุฏูุงุฆู
                        setInterval(() => {
                            registration.update();
                        }, 5 * 60 * 1000);
                        
                        // ุฅุดุนุงุฑ ุจูุฌูุฏ ุชุญุฏูุซ
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // ููุฌุฏ ูุณุฎุฉ ุฌุฏูุฏุฉ
                                    if (confirm('๐ ููุฌุฏ ุชุญุฏูุซ ุฌุฏูุฏ ููุชุทุจูู. ุชุญุฏูุซ ุงูุขูุ')) {
                                        newWorker.postMessage({ type: 'SKIP_WAITING' });
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.error('โ [PWA] Service Worker registration failed:', error);
                    });
            });
            
            // ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ ุนูุฏ ุชูุนูู SW ุฌุฏูุฏ
            navigator.serviceWorker.addEventListener('controllerchange', () => {
                window.location.reload();
            });
        }
        
        // ุฏุงูุฉ ูุชูุธูู ุงููุงุด ูุฏููุงู (ุงุณุชุฎุฏููุง ูู Console)
        window.clearAppCache = function() {
            if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
                navigator.serviceWorker.controller.postMessage({ type: 'CLEAR_CACHE' });
                console.log('๐๏ธ Cache cleared!');
            }
            localStorage.clear();
            sessionStorage.clear();
            window.location.reload();
        };
    </script>
    
</body>
</html>